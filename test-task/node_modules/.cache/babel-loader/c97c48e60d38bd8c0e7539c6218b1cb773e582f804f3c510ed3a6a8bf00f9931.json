{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useDispatch,useSelector}from'react-redux';import md5 from\"md5\";import Product from\"./Product.js\";import'./Main.css';import{PagesLinks}from\"./PagesLinks.js\";import{useParams}from\"react-router-dom\";// import Filter from './Filter.js';\nimport{updateID}from\"../redux/productsSlice.js\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const Main=props=>{const dispatch=useDispatch();let params=useParams();let num;if(Object.keys(params).length){params=[...params.clid];num=parseInt(params[1]);}const[products,setProducts]=useState(null);const[dataLoadState,setDataLoadState]=useState(0);// 0 - not loaded, 1 - is loading, 2 - loaded, 3 - error\nconst[dataLoadError,setDataLoadError]=useState(null);const idProductsCheck=useSelector(state=>state.products.idProcductCheck);let productsJSX;useEffect(()=>{if(idProductsCheck===\"Нет элементов, удовлетворяющих запросу\"){setProducts(idProductsCheck);}else{fetch(\"http://api.valantis.store:40000/\",{method:'POST',headers:{'Content-Type':'application/json',\"X-Auth\":md5(\"Valantis_\".concat(new Date().toISOString().slice(0,10).split('-').join('')))},body:JSON.stringify({\"action\":\"get_ids\",\"params\":{\"offset\":num,\"limit\":51}})}).then(response=>{if(!response.ok){throw new Error(\"fetch error \"+response.status);}else return response.json();}).then(data=>{// dispatch( updateID(data.result) );\nreturn fetch(\"http://api.valantis.store:40000/\",{method:'POST',headers:{'Content-Type':'application/json',\"X-Auth\":md5(\"Valantis_\".concat(new Date().toISOString().slice(0,10).split('-').join('')))},body:JSON.stringify({\"action\":\"get_items\",\"params\":{\"ids\":idProductsCheck.length>0?idProductsCheck:data.result}})});}).then(response=>{if(!response.ok){throw new Error(\"fetch error \"+response.status);}else return response.json();}).then(data=>{setDataLoadState(2);setDataLoadError(null);let productsData=data.result.reduce((accumulator,current)=>{if(accumulator.findIndex(object=>object.id===current.id)===-1){accumulator.push(current);}return accumulator;},[]);setProducts(productsData);}).catch(error=>{setDataLoadState(3);setDataLoadError(\"HTTP error \"+error.message);});}},[num,idProductsCheck]);if(!(products===\"Нет элементов, удовлетворяющих запросу\")&&products){productsJSX=products.map((element,index)=>{return/*#__PURE__*/_jsx(Product,{info:element},element.id);});}else if(products===\"Нет элементов, удовлетворяющих запросу\"){productsJSX=/*#__PURE__*/_jsx(\"div\",{children:products});}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{children:productsJSX}),/*#__PURE__*/_jsx(PagesLinks,{})]});};export default Main;","map":{"version":3,"names":["React","useEffect","useState","useDispatch","useSelector","md5","Product","PagesLinks","useParams","updateID","jsx","_jsx","jsxs","_jsxs","Main","props","dispatch","params","num","Object","keys","length","clid","parseInt","products","setProducts","dataLoadState","setDataLoadState","dataLoadError","setDataLoadError","idProductsCheck","state","idProcductCheck","productsJSX","fetch","method","headers","concat","Date","toISOString","slice","split","join","body","JSON","stringify","then","response","ok","Error","status","json","data","result","productsData","reduce","accumulator","current","findIndex","object","id","push","catch","error","message","map","element","index","info","children"],"sources":["/Users/yanaleonovich/1/Test-task/test-task/src/components/Main.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport md5 from \"md5\";\n\nimport Product from \"./Product.js\";\nimport './Main.css';\nimport {PagesLinks} from \"./PagesLinks.js\";\nimport {useParams} from \"react-router-dom\";\n// import Filter from './Filter.js';\n\nimport { updateID} from \"../redux/productsSlice.js\";\n\nconst Main = (props) => {\n\n    const dispatch = useDispatch();\n\n    let params = useParams();\n    let num;\n    if(Object.keys(params).length) {\n        params = [...params.clid];\n        num = parseInt(params[1]);\n    }\n\n    const [products, setProducts] = useState(null);\n    const [dataLoadState, setDataLoadState] = useState(0); // 0 - not loaded, 1 - is loading, 2 - loaded, 3 - error\n    const [dataLoadError, setDataLoadError] = useState(null);\n    \n    const idProductsCheck = useSelector( state => state.products.idProcductCheck);\n\n    let productsJSX;\n\n    useEffect(\n        ()=>{\n            if (idProductsCheck === \"Нет элементов, удовлетворяющих запросу\") {\n                setProducts(idProductsCheck)\n            } else {\n                fetch(\"http://api.valantis.store:40000/\",\n            { method: 'POST',\n            headers: { 'Content-Type': 'application/json', \"X-Auth\": md5(`Valantis_${new Date().toISOString().slice(0, 10).split('-').join('')}`) },\n            body: JSON.stringify( {\"action\": \"get_ids\",\n                                   \"params\": {\"offset\": num, \"limit\": 51}} )\n            })\n            .then( response => {\n                if (!response.ok) {\n                    throw new Error(\"fetch error \" + response.status);\n                } else\n                    return response.json();\n            })\n            .then( data => {\n                // dispatch( updateID(data.result) );\n                return fetch(\"http://api.valantis.store:40000/\",\n                       { method: 'POST',\n                       headers: { 'Content-Type': 'application/json', \"X-Auth\": md5(`Valantis_${new Date().toISOString().slice(0, 10).split('-').join('')}`) },\n                       body: JSON.stringify( {\"action\": \"get_items\",\n                                              \"params\": {\"ids\": idProductsCheck.length > 0 ? idProductsCheck : data.result}} )\n                        });\n            })\n            .then( response => {\n                if (!response.ok) {\n                    throw new Error(\"fetch error \" + response.status);\n                } else\n                    return response.json();\n            })\n            .then(data => {\n                setDataLoadState(2);\n                setDataLoadError(null);\n                let productsData = data.result.reduce((accumulator, current) => {\n                    if (accumulator.findIndex(object => object.id === current.id) === -1) {\n                        accumulator.push(current);\n                    }\n                    return accumulator;\n                }, []);\n                setProducts(productsData);\n            })\n            .catch( error => {\n                setDataLoadState(3);\n                setDataLoadError(\"HTTP error \"+error.message);\n            });\n            }\n        }, [num, idProductsCheck]);\n\n        \n        if(!(products === \"Нет элементов, удовлетворяющих запросу\") && products) {\n            productsJSX = products.map((element, index) => {\n                return <Product key = {element.id}\n                                info = {element}/>\n            })\n        } else if (products === \"Нет элементов, удовлетворяющих запросу\") {\n            productsJSX = <div>{products}</div>\n        }\n\n    return (\n        <div>\n            <div>{productsJSX}</div>\n            <PagesLinks />\n        </div>\n    );\n  };\n  \n  export default Main;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}